{"version":3,"file":"js/384.44c70a78.js","mappings":"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","sources":["webpack://graduate/./src/views/CesiumSymbolPrimitive.vue?4f10","webpack://graduate/./src/utils/cesium-primitive.ts","webpack://graduate/./src/views/CesiumSymbolPrimitive.vue","webpack://graduate/./src/views/CesiumSymbolPrimitive.vue?01fe"],"sourcesContent":["import { openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = {\n  class: \"map\",\n  ref: \"container\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, null, 512);\n}","import * as Cesium from \"cesium\";\r\nimport axios from \"axios\";\r\nimport { encodeFloatToDouble } from \"@/utils/common\";\r\nimport { mat4 } from \"gl-matrix\";\r\nimport { Viewer } from \"cesium\";\r\n\r\nexport class SymbolCustomPrimitive {\r\n  view: Viewer;\r\n  attributeLocations;\r\n  vertexScript;\r\n  fragmentScript;\r\n  positionHeight;\r\n  positionLow;\r\n  simpleArray;\r\n  rotationArray;\r\n  symbolTextureImage;\r\n  paletteTextureImage;\r\n  u_symbolMatrix;\r\n  u_bufferSize;\r\n\r\n  commandToExecute: any;\r\n  constructor(option: {\r\n    view: Viewer;\r\n    attributeLocations: { [key: string]: number };\r\n    vertexScript: string;\r\n    fragmentScript: string;\r\n    positionHeight: number[];\r\n    positionLow: number[];\r\n    simpleArray: number[];\r\n    rotationArray: number[];\r\n    symbolTextureImage: HTMLImageElement;\r\n    paletteTextureImage: HTMLImageElement;\r\n\r\n    u_bufferSize: number[];\r\n  }) {\r\n    this.view = option.view;\r\n    this.attributeLocations = option.attributeLocations;\r\n    this.vertexScript = option.vertexScript;\r\n    this.fragmentScript = option.fragmentScript;\r\n    this.positionHeight = option.positionHeight;\r\n    this.positionLow = option.positionLow;\r\n    this.simpleArray = option.simpleArray;\r\n    this.rotationArray = option.rotationArray;\r\n    this.symbolTextureImage = option.symbolTextureImage;\r\n    this.paletteTextureImage = option.paletteTextureImage;\r\n\r\n    const modelMatrix = mat4.create();\r\n    mat4.identity(modelMatrix);\r\n    mat4.scale(modelMatrix, modelMatrix, [50 * window.devicePixelRatio, 50 * window.devicePixelRatio, 1.0]);\r\n    this.u_symbolMatrix = modelMatrix;\r\n    this.u_bufferSize = option.u_bufferSize;\r\n  }\r\n\r\n  getVertexArray(context: any) {\r\n    // const buffer = (Cesium as any).Buffer.createVertexBuffer({\r\n    //   context: context,\r\n    //   usage: (Cesium as any).BufferUsage.STATIC_DRAW,\r\n    //   typedArray: new Float32Array([...this.simpleArray, ...this.positionHeight, ...this.positionLow, ...this.rotationArray]),\r\n    // });\r\n    const simpleBuffer = (Cesium as any).Buffer.createVertexBuffer({\r\n      context: context,\r\n      usage: (Cesium as any).BufferUsage.STATIC_DRAW,\r\n      typedArray: new Float32Array(this.simpleArray),\r\n    });\r\n    const positionHeightBuffer = (Cesium as any).Buffer.createVertexBuffer({\r\n      context: context,\r\n      usage: (Cesium as any).BufferUsage.STATIC_DRAW,\r\n      typedArray: new Float32Array(this.positionHeight),\r\n    });\r\n    const positionLowBuffer = (Cesium as any).Buffer.createVertexBuffer({\r\n      context: context,\r\n      usage: (Cesium as any).BufferUsage.STATIC_DRAW,\r\n      typedArray: new Float32Array(this.positionLow),\r\n    });\r\n    const rotationBuffer = (Cesium as any).Buffer.createVertexBuffer({\r\n      context: context,\r\n      usage: (Cesium as any).BufferUsage.STATIC_DRAW,\r\n      typedArray: new Float32Array(this.rotationArray),\r\n    });\r\n\r\n    const VAO = new (Cesium as any).VertexArray({\r\n      context: context,\r\n      attributes: [\r\n        {\r\n          index: 1,\r\n          enabled: true,\r\n          vertexBuffer: simpleBuffer,\r\n          componentsPerAttribute: 4,\r\n          componentDatatype: Cesium.ComponentDatatype.FLOAT,\r\n          normalize: false,\r\n          offseInBytes: 0,\r\n          strideInBytes: (Cesium.ComponentDatatype as any).getSizeInBytes(Cesium.ComponentDatatype.FLOAT) * 4,\r\n          instanceDivisor: 1,\r\n        },\r\n        {\r\n          index: 2,\r\n          enabled: true,\r\n          vertexBuffer: positionHeightBuffer,\r\n          componentsPerAttribute: 3,\r\n          componentDatatype: Cesium.ComponentDatatype.FLOAT,\r\n          normalize: false,\r\n          offseInBytes: 0,\r\n          strideInBytes: (Cesium.ComponentDatatype as any).getSizeInBytes(Cesium.ComponentDatatype.FLOAT) * 3,\r\n          instanceDivisor: 1,\r\n        },\r\n        {\r\n          index: 3,\r\n          enabled: true,\r\n          vertexBuffer: positionLowBuffer,\r\n          componentsPerAttribute: 3,\r\n          componentDatatype: Cesium.ComponentDatatype.FLOAT,\r\n          normalize: false,\r\n          offseInBytes: (Cesium.ComponentDatatype as any).getSizeInBytes(Cesium.ComponentDatatype.FLOAT) * 8 * this.rotationArray.length,\r\n          strideInBytes: (Cesium.ComponentDatatype as any).getSizeInBytes(Cesium.ComponentDatatype.FLOAT) * 4,\r\n          instanceDivisor: 1,\r\n        },\r\n        {\r\n          index: 4,\r\n          enabled: true,\r\n          vertexBuffer: rotationBuffer,\r\n          componentsPerAttribute: 1,\r\n          componentDatatype: Cesium.ComponentDatatype.FLOAT,\r\n          normalize: false,\r\n          offseInBytes: (Cesium.ComponentDatatype as any).getSizeInBytes(Cesium.ComponentDatatype.FLOAT) * 12 * this.rotationArray.length,\r\n          strideInBytes: (Cesium.ComponentDatatype as any).getSizeInBytes(Cesium.ComponentDatatype.FLOAT),\r\n          instanceDivisor: 1,\r\n        },\r\n      ],\r\n    });\r\n    return VAO;\r\n  }\r\n\r\n  getShaderProgram(context: any) {\r\n    return (Cesium as any).ShaderProgram.fromCache({\r\n      context: context,\r\n      vertexShaderSource: this.vertexScript,\r\n      fragmentShaderSource: this.fragmentScript,\r\n      attributeLocations: this.attributeLocations,\r\n    });\r\n  }\r\n\r\n  getTexture(context: any, data: HTMLImageElement) {\r\n    return new (Cesium as any).Texture({\r\n      context: context,\r\n      source: data,\r\n      flipY: false,\r\n      sampler: new (Cesium as any).Sampler({\r\n        minificationFilter: Cesium.TextureMinificationFilter.NEAREST,\r\n        magnificationFilter: Cesium.TextureMagnificationFilter.NEAREST,\r\n      }),\r\n    });\r\n  }\r\n\r\n  getUniformMap(context: any) {\r\n    return {\r\n      symbolTexture: () => {\r\n        return this.getTexture(context, this.symbolTextureImage);\r\n      },\r\n      paletteTexture: () => {\r\n        return this.getTexture(context, this.paletteTextureImage);\r\n      },\r\n      u_symbolMatrix: () => {\r\n        return new Cesium.Matrix4(...this.u_symbolMatrix);\r\n      },\r\n      u_bufferSize: () => {\r\n        return new Cesium.Cartesian2(...this.u_bufferSize);\r\n      },\r\n      u_cartesianCenterHigh: () => {\r\n        const center = this.view.camera.position;\r\n\r\n        const cartesianX = encodeFloatToDouble(center.x);\r\n        const cartesianY = encodeFloatToDouble(center.y);\r\n        const cartesianZ = encodeFloatToDouble(center.z);\r\n        return new Cesium.Cartesian3(cartesianX[0], cartesianY[0], cartesianZ[0]);\r\n      },\r\n      u_cartesianCenterLow: () => {\r\n        const center = this.view.camera.position;\r\n\r\n        const cartesianX = encodeFloatToDouble(center.x);\r\n        const cartesianY = encodeFloatToDouble(center.y);\r\n        const cartesianZ = encodeFloatToDouble(center.z);\r\n        return new Cesium.Cartesian3(cartesianX[1], cartesianY[1], cartesianZ[1]);\r\n      },\r\n      color: () => {\r\n        return new Cesium.Cartesian3(Math.random(), Math.random(), Math.random());\r\n      },\r\n    };\r\n  }\r\n\r\n  createCommand(context: any) {\r\n    // const renderState = (Cesium as any).RenderState.fromCache({\r\n    //   cull: {\r\n    //     enabled: true,\r\n    //     face: Cesium.CullFace.BACK,\r\n    //   },\r\n    //   depthTest: {\r\n    //     enabled: false,\r\n    //   },\r\n\r\n    //   blending: {\r\n    //     enabled: true,\r\n    //     equationRgb: Cesium.BlendEquation.ADD,\r\n    //     equationAlpha: Cesium.BlendEquation.ADD,\r\n    //     functionSourceRgb: Cesium.BlendFunction.ONE,\r\n    //     functionSourceAlpha: Cesium.BlendFunction.ONE,\r\n    //     functionDestinationRgb: Cesium.BlendFunction.ONE_MINUS_SOURCE_ALPHA,\r\n    //     functionDestinationAlpha: Cesium.BlendFunction.ONE_MINUS_SOURCE_ALPHA,\r\n    //   },\r\n    // });\r\n    const renderState = createRawRenderState({\r\n      // undefined value means let Cesium deal with it\r\n      viewport: undefined,\r\n      depthTest: {\r\n        enabled: false,\r\n      },\r\n      depthMask: false,\r\n      blending: {\r\n        enabled: false,\r\n      },\r\n      cull: {\r\n        enabled: false,\r\n        face: Cesium.CullFace.BACK,\r\n      },\r\n    });\r\n\r\n    return new (Cesium as any).DrawCommand({\r\n      owner: this,\r\n      vertexArray: this.getVertexArray(context),\r\n      count: 64,\r\n      instanceCount: this.rotationArray.length,\r\n      // instanceCount: 1,\r\n      // primitiveType: Cesium.PrimitiveType.POINTS,\r\n      primitiveType: Cesium.PrimitiveType.TRIANGLE_STRIP,\r\n      uniformMap: this.getUniformMap(context),\r\n      shaderProgram: this.getShaderProgram(context),\r\n      renderState: (Cesium as any).RenderState.fromCache(renderState),\r\n      pass: (Cesium as any).Pass.OPAQUE,\r\n    });\r\n  }\r\n\r\n  update(frameState: any) {\r\n    // if (!this.show) return;\r\n    // if you do not want to show the CustomPrimitive, use return statement to bypass the update\r\n    console.log(123)\r\n    // if (!Cesium.defined(this.commandToExecute)) {\r\n    //   this.commandToExecute = this.createCommand(frameState.context);\r\n    // }\r\n    // frameState.commandList.push(this.commandToExecute);\r\n  }\r\n\r\n  isDestroyed() {\r\n    // return true or false to indicate whether the CustomPrimitive is destroyed\r\n  }\r\n\r\n  destroy() {\r\n    // this method will be called when the CustomPrimitive is no longer used\r\n  }\r\n}\r\n\r\nexport const initResource = async (\r\n  type: string,\r\n  number: number,\r\n  positionJsonAddress: string,\r\n  infoJsonAddress: string,\r\n  vertexScriptAddress: string,\r\n  fragmentScriptAddress: string,\r\n  stripAddress: string,\r\n  paletteAddress: string\r\n) => {\r\n  const positionPromise = new Promise((resolve, reject) => {\r\n    axios.get(positionJsonAddress).then((res) => resolve(res.data));\r\n  });\r\n  const infoPromise = new Promise((resolve, reject) => {\r\n    axios.get(infoJsonAddress).then((res) => resolve(res.data));\r\n  });\r\n  const vertexScriptPromise = getShader(vertexScriptAddress);\r\n  const fragmentScriptPromise = getShader(fragmentScriptAddress);\r\n  const stripImage = getImage(stripAddress);\r\n  const paletteImage = getImage(paletteAddress);\r\n  const simpleArray: number[] = [];\r\n  const positionHeight: number[] = [];\r\n  const positionLow: number[] = [];\r\n  const rotationArray: number[] = [];\r\n  return Promise.all([infoPromise, positionPromise, vertexScriptPromise, fragmentScriptPromise, stripImage, paletteImage]).then((res) => {\r\n    const arr = (res[0] as any).markers.description;\r\n    for (let i = 0; i < arr.length; i++) {\r\n      if (arr[i].name === type) {\r\n        const instanceNum = Math.ceil(arr[i].length / number);\r\n        for (let j = 0; j < (res[1] as any).features.length; j++) {\r\n          const item = (res[1] as any).features[j];\r\n          const coord = Cesium.Cartesian3.fromDegrees(item.geometry.coordinates[0], item.geometry.coordinates[1]);\r\n          // positionHeight.push(coord.x, coord.y, coord.z);\r\n          for (let k = 0; k < instanceNum; k++) {\r\n            simpleArray.push(arr[i].base, arr[i].length, k, arr[i].ID);\r\n\r\n            const positionX = encodeFloatToDouble(coord.x);\r\n            const positionY = encodeFloatToDouble(coord.y);\r\n            const positionZ = encodeFloatToDouble(coord.z);\r\n            // positionHeight.push(positionX[0], positionY[0], positionZ[0]);\r\n            positionHeight.push(coord.x, coord.y, coord.z);\r\n            positionLow.push(positionX[1], positionY[1], positionZ[1]);\r\n            rotationArray.push(0);\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return [simpleArray, positionHeight, positionLow, rotationArray, res[2], res[3], res[4], res[5]];\r\n  });\r\n};\r\n\r\nasync function getShader(address: string) {\r\n  const shaderScript = await axios.get(address).then((res) => res.data);\r\n  return shaderScript;\r\n}\r\n\r\nasync function getImage(address: string) {\r\n  return new Promise((resolve, reject) => {\r\n    const image = new Image();\r\n    image.src = address;\r\n    image.onload = () => {\r\n      resolve(image);\r\n    };\r\n  }).then((res) => res);\r\n}\r\n\r\nconst createRawRenderState = function (options: any) {\r\n  var translucent = true;\r\n  var closed = false;\r\n  var existing = {\r\n    viewport: options.viewport,\r\n    depthTest: options.depthTest,\r\n    depthMask: options.depthMask,\r\n    blending: options.blending,\r\n  };\r\n\r\n  var rawRenderState = (Cesium as any).Appearance.getDefaultRenderState(translucent, closed, existing);\r\n  return rawRenderState;\r\n};\r\n\r\n// export class TestPrimitive {\r\n//   attributeLocations;\r\n//   vertexScript;\r\n//   fragmentScript;\r\n\r\n//   commandToExecute: any;\r\n//   image: HTMLImageElement;\r\n//   constructor(option: { attributeLocations: { [key: string]: number }; vertexScript: string; fragmentScript: string; textureImage: HTMLImageElement }) {\r\n//     this.attributeLocations = option.attributeLocations;\r\n//     this.vertexScript = option.vertexScript;\r\n//     this.fragmentScript = option.fragmentScript;\r\n//     this.image = option.textureImage;\r\n//   }\r\n\r\n//   getVertexArray(context: any) {\r\n//     const getCoordinate = (lon: number, lat: number) => {\r\n//       const res = Cesium.Cartesian3.fromDegrees(lon, lat);\r\n//       return [res.x, res.y, res.z];\r\n//     };\r\n\r\n//     const buffer = (Cesium as any).Buffer.createVertexBuffer({\r\n//       context: context,\r\n//       usage: (Cesium as any).BufferUsage.STATIC_DRAW,\r\n//       typedArray: new Float32Array([...getCoordinate(119, 32), ...getCoordinate(120, 32), ...getCoordinate(119, 31), ...getCoordinate(119, 31), ...getCoordinate(120, 31), ...getCoordinate(120, 32)]),\r\n//     });\r\n\r\n//     const textureCoor = (Cesium as any).Buffer.createVertexBuffer({\r\n//       context: context,\r\n//       usage: (Cesium as any).BufferUsage.STATIC_DRAW,\r\n//       typedArray: new Float32Array([0, 1, 1, 1, 0, 0, 0, 0, 1, 0, 1, 1]),\r\n//     });\r\n\r\n//     const VAO = new (Cesium as any).VertexArray({\r\n//       context: context,\r\n//       attributes: [\r\n//         {\r\n//           index: 1,\r\n//           vertexBuffer: buffer,\r\n//           componentsPerAttribute: 3,\r\n//           componentDatatype: Cesium.ComponentDatatype.FLOAT,\r\n//           normalize: false,\r\n//           // offseInBytes: 0,\r\n//           // strideInByes: 0,\r\n//           // instanceDivisor: 1,\r\n//         },\r\n//         {\r\n//           index: 2,\r\n//           vertexBuffer: textureCoor,\r\n//           componentsPerAttribute: 2,\r\n//           componentDatatype: Cesium.ComponentDatatype.FLOAT,\r\n//           normalize: false,\r\n//           // offseInBytes: 0,\r\n//           // strideInByes: 0,\r\n//           // instanceDivisor: 1,\r\n//         },\r\n//       ],\r\n//     });\r\n//     return VAO;\r\n//   }\r\n\r\n//   getShaderProgram(context: any) {\r\n//     return (Cesium as any).ShaderProgram.fromCache({\r\n//       context: context,\r\n//       vertexShaderSource: this.vertexScript,\r\n//       fragmentShaderSource: this.fragmentScript,\r\n//       attributeLocations: this.attributeLocations,\r\n//     });\r\n//   }\r\n\r\n//   getTexture(context: any, data: HTMLImageElement) {\r\n//     return new (Cesium as any).Texture({\r\n//       context: context,\r\n//       source: data,\r\n//       sampler: new (Cesium as any).Sampler({\r\n//         minificationFilter: Cesium.TextureMinificationFilter.LINEAR,\r\n//         magnificationFilter: Cesium.TextureMagnificationFilter.LINEAR,\r\n//       }),\r\n//     });\r\n//   }\r\n\r\n//   getUniformMap(context: any) {\r\n//     return {\r\n//       matrix: () => {\r\n//         const matrix = mat4.create();\r\n//         mat4.identity(matrix);\r\n//         const translateMatrix = mat4.translate(mat4.create(), matrix, [0.5, 0.0, 0.0]);\r\n//         return new Cesium.Matrix4(...translateMatrix);\r\n//       },\r\n//       u_texture: () => {\r\n//         return this.getTexture(context, this.image);\r\n//       },\r\n//     };\r\n//   }\r\n\r\n//   createCommand(context: any) {\r\n//     const renderState = createRawRenderState({\r\n//       // undefined value means let Cesium deal with it\r\n//       viewport: undefined,\r\n//       depthTest: {\r\n//         enabled: false,\r\n//       },\r\n//       depthMask: false,\r\n//       blending: {\r\n//         enabled: true,\r\n//       },\r\n//     });\r\n//     return new (Cesium as any).DrawCommand({\r\n//       owner: this,\r\n//       vertexArray: this.getVertexArray(context),\r\n//       primitiveType: Cesium.PrimitiveType.POINTS,\r\n//       // count: 64,\r\n//       count: 6,\r\n//       // instanceCount: 2,\r\n//       // primitiveType: Cesium.PrimitiveType.TRIANGLE_STRIP,\r\n//       uniformMap: this.getUniformMap(context),\r\n//       shaderProgram: this.getShaderProgram(context),\r\n//       renderState: (Cesium as any).RenderState.fromCache(renderState),\r\n//       pass: (Cesium as any).Pass.OPAQUE,\r\n//     });\r\n//   }\r\n\r\n//   update(frameState: any) {\r\n//     // if (!this.show) return;\r\n//     // if you do not want to show the CustomPrimitive, use return statement to bypass the update\r\n//     if (!Cesium.defined(this.commandToExecute)) {\r\n//       this.commandToExecute = this.createCommand(frameState.context);\r\n//     }\r\n//     frameState.commandList.push(this.commandToExecute);\r\n//   }\r\n\r\n//   isDestroyed() {\r\n//     // return true or false to indicate whether the CustomPrimitive is destroyed\r\n//   }\r\n\r\n//   destroy() {\r\n//     // this method will be called when the CustomPrimitive is no longer used\r\n//   }\r\n// }\r\n","import { defineComponent, onMounted, ref } from \"vue\";\nimport { Ion, Viewer } from \"cesium\";\nimport * as Cesium from \"cesium\";\nimport \"cesium/Build/Cesium/Widgets/widgets.css\";\nimport { SymbolCustomPrimitive, initResource } from \"@/utils/cesium-primitive\";\nexport default defineComponent({\n  setup() {\n    const container = ref();\n    Ion.defaultAccessToken = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiIxNjRiYjA0OS0wYTNjLTQwODItYjhmOS1kNTA3NTNlMzhiZWIiLCJpZCI6MTcxNjM3LCJpYXQiOjE2OTcxODE0NDN9.NXFWJtgHshH3lJbrl9QmfjGM3-KRRoQpy5827zZJJV0\";\n    const initMap = async () => {\n      const data = await initResource(\"campfire\", 64, `${process.env.VUE_APP_RESOURCE_PREFIX}/symbol/json/crossroad_NJ.geojson`, `${process.env.VUE_APP_RESOURCE_PREFIX}/symbol/json/tbvs.json`, `${process.env.VUE_APP_RESOURCE_PREFIX}/symbol/shader/symbol3D-primitive.vert.glsl`, `${process.env.VUE_APP_RESOURCE_PREFIX}/symbol/shader/symbol3D-primitive.frag.glsl`, `${process.env.VUE_APP_RESOURCE_PREFIX}/symbol/texture/strip.png`, `${process.env.VUE_APP_RESOURCE_PREFIX}/symbol/texture/palette.png`);\n      const view = new Viewer(container.value, {\n        msaaSamples: 2,\n        requestRenderMode: true,\n        maximumRenderTimeChange: Infinity\n      });\n      view.camera.setView({\n        destination: Cesium.Cartesian3.fromDegrees(118.81259, 32.048116, 400000),\n        orientation: {\n          heading: Cesium.Math.toRadians(0.0),\n          pitch: Cesium.Math.toRadians(-90.0)\n        }\n      });\n      view.scene.primitives.add(new SymbolCustomPrimitive({\n        view: view,\n        attributeLocations: {\n          sampleInfo: 1,\n          geoPosition_height: 2,\n          geoPosition_low: 3,\n          rotation: 4\n        },\n        vertexScript: data[4],\n        fragmentScript: data[5],\n        positionHeight: data[1],\n        positionLow: data[2],\n        simpleArray: data[0],\n        rotationArray: data[3],\n        symbolTextureImage: data[6],\n        paletteTextureImage: data[7],\n        u_bufferSize: [view.scene.canvas.width, view.scene.canvas.height]\n      }));\n    };\n    onMounted(initMap);\n    return {\n      container\n    };\n  }\n});","/* unplugin-vue-components disabled */import { render } from \"./CesiumSymbolPrimitive.vue?vue&type=template&id=789274b1&ts=true\"\nimport script from \"./CesiumSymbolPrimitive.vue?vue&type=script&lang=ts\"\nexport * from \"./CesiumSymbolPrimitive.vue?vue&type=script&lang=ts\"\n\nimport \"./CesiumSymbolPrimitive.vue?vue&type=style&index=0&id=789274b1&lang=css\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"names":["_hoisted_1","class","ref","render","_ctx","_cache","$props","$setup","$data","$options","SymbolCustomPrimitive","constructor","option","_defineProperty","this","view","attributeLocations","vertexScript","fragmentScript","positionHeight","positionLow","simpleArray","rotationArray","symbolTextureImage","paletteTextureImage","modelMatrix","mat4","window","devicePixelRatio","u_symbolMatrix","u_bufferSize","getVertexArray","context","simpleBuffer","Cesium","createVertexBuffer","usage","STATIC_DRAW","typedArray","Float32Array","positionHeightBuffer","positionLowBuffer","rotationBuffer","VAO","attributes","index","enabled","vertexBuffer","componentsPerAttribute","componentDatatype","FLOAT","normalize","offseInBytes","strideInBytes","getSizeInBytes","instanceDivisor","length","getShaderProgram","fromCache","vertexShaderSource","fragmentShaderSource","getTexture","data","source","flipY","sampler","minificationFilter","NEAREST","magnificationFilter","getUniformMap","symbolTexture","paletteTexture","u_cartesianCenterHigh","center","camera","position","cartesianX","encodeFloatToDouble","x","cartesianY","y","cartesianZ","z","u_cartesianCenterLow","color","Math","random","createCommand","renderState","createRawRenderState","viewport","undefined","depthTest","depthMask","blending","cull","face","BACK","owner","vertexArray","count","instanceCount","primitiveType","TRIANGLE_STRIP","uniformMap","shaderProgram","pass","OPAQUE","update","frameState","console","log","isDestroyed","destroy","initResource","async","type","number","positionJsonAddress","infoJsonAddress","vertexScriptAddress","fragmentScriptAddress","stripAddress","paletteAddress","positionPromise","Promise","resolve","reject","axios","get","then","res","infoPromise","vertexScriptPromise","getShader","fragmentScriptPromise","stripImage","getImage","paletteImage","all","arr","markers","description","i","name","instanceNum","ceil","j","features","item","coord","fromDegrees","geometry","coordinates","k","push","base","ID","positionX","positionY","positionZ","address","shaderScript","image","Image","src","onload","options","translucent","closed","existing","rawRenderState","getDefaultRenderState","setup","container","Ion","defaultAccessToken","initMap","Viewer","value","msaaSamples","requestRenderMode","maximumRenderTimeChange","Infinity","setView","destination","orientation","heading","toRadians","pitch","scene","primitives","add","sampleInfo","geoPosition_height","geoPosition_low","rotation","canvas","width","height","__exports__"],"sourceRoot":""}